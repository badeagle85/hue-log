---
import { Image } from 'astro:assets';
import { getCollection } from 'astro:content';
import BaseHead from '../../components/BaseHead.astro';
import Footer from '../../components/Footer.astro';
import FormattedDate from '../../components/FormattedDate.astro';
import Header from '../../components/Header.astro';
import { SITE_DESCRIPTION, SITE_TITLE } from '../../consts';

const posts = (await getCollection('blog'))
	.filter((post) => !post.data.draft) // draft가 false인 글만 표시
	.sort(
		(a, b) => b.data.createdAt.valueOf() - a.data.createdAt.valueOf(),
	);
---

<!doctype html>
<html lang="ko">
	<head>
		<BaseHead title={`${SITE_TITLE} - Blog`} description={SITE_DESCRIPTION} />
	</head>
	<body class="bg-white dark:bg-gray-900">
		<Header />
		<main class="container mx-auto px-4 sm:px-6 lg:px-8 py-12">
			<div class="max-w-6xl mx-auto">
				<h1 class="text-4xl font-bold text-gray-900 dark:text-white mb-8">
					Blog Posts
				</h1>

				<div class="grid gap-8 md:grid-cols-2 lg:grid-cols-3">
					{
						posts.map((post) => (
							<article class="group">
								<a href={`/hue-log/blog/${post.id}/`} class="block">
									<div class="overflow-hidden rounded-lg border border-gray-200 dark:border-gray-700 bg-white dark:bg-gray-800 shadow-sm hover:shadow-lg transition-all duration-300 h-full">
										{post.data.heroImage && (
											<div class="aspect-w-16 aspect-h-9 overflow-hidden">
												<Image
													width={720}
													height={360}
													src={post.data.heroImage}
													alt={post.data.title}
													class="object-cover w-full h-48 group-hover:scale-105 transition-transform duration-300"
												/>
											</div>
										)}

										<div class="p-6">
											<div class="flex items-center gap-2 text-sm text-gray-600 dark:text-gray-400 mb-2">
												<FormattedDate date={post.data.createdAt} />
												{post.data.category && (
													<>
														<span>•</span>
														<span class="text-purple-600 dark:text-purple-400">
															{post.data.category}
														</span>
													</>
												)}
											</div>

											<h2 class="text-xl font-semibold text-gray-900 dark:text-white mb-2 group-hover:text-purple-600 dark:group-hover:text-purple-400 transition-colors">
												{post.data.title}
											</h2>

											<p class="text-gray-600 dark:text-gray-300 line-clamp-3 mb-4">
												{post.data.description}
											</p>

											{post.data.tags && post.data.tags.length > 0 && (
												<div class="flex flex-wrap gap-2">
													{post.data.tags.slice(0, 3).map((tag) => (
														<span class="inline-block px-2 py-1 text-xs font-medium text-purple-700 dark:text-purple-300 bg-purple-100 dark:bg-purple-900/30 rounded">
															#{tag}
														</span>
													))}
												</div>
											)}
										</div>
									</div>
								</a>
							</article>
						))
					}
				</div>

				{posts.length === 0 && (
					<div class="text-center py-20">
						<p class="text-gray-500 dark:text-gray-400 text-lg">
							아직 작성된 포스트가 없습니다.
						</p>
					</div>
				)}
			</div>
		</main>
		<Footer />
	</body>
</html>

<style>
	.line-clamp-3 {
		display: -webkit-box;
		-webkit-line-clamp: 3;
		-webkit-box-orient: vertical;
		overflow: hidden;
	}

	.aspect-w-16 {
		position: relative;
		padding-bottom: 56.25%;
	}

	.aspect-w-16 > * {
		position: absolute;
		height: 100%;
		width: 100%;
		top: 0;
		right: 0;
		bottom: 0;
		left: 0;
	}
</style>